# Chapter 2. 렉시컬 스코프(Lexical Scope)
스코프는 크게 다수의 프로그래밍 언어가 사용하는 `렉시컬 스코프` 방식과, Bash Scripting 이나 Perl의 일부 모드와 같은 몊몊 언어에서 사용하는 `동적 스코프` 방식이 있다.

## 2.1 렉스타임
컴파일러 언어는 첫 단계에서 토크나이징 또는 렉싱이라는 작업을 진행하고, 렉싱 처리 과정에서 소스 코드 문자열을 분석해서 상태유지 파싱의 결과로 생성된 토큰에 의미를 부여한다. 

렉시컬 스코프란 프로그래머가 코드를 작성할 때, 변수와 스코프 블럭을 어디에 작성하는가에 기초해서 `렉서(Lexer)`가 코드를 처리할 때 확정되는 스코프이다.

``` js
// 1번 스코프
function foo(a) { //2번 스코프
  var b = a * 2;
  function bar(c) { //3 스코프
    console.log( a, b, c);
  }
  bar(b * 3);
}
```

위 예제 코드에는 총 3개의 스코프가 존재한다.
- 1. 글로벌 스코프를 감싸고 있으며, 해당 스코프 안에는 하나의 확인자(foo)만 존재한다.
- 2. foo의 스코프를 감싸고 있으며, 해당 스코프 안에는 세개의 확인자(a, b, bar)가 존재한다.
- 3. bar의 스코프를 감싸고 있으며, 해당 스코프 안에는 하나의 확인자(c)가 존재한다.

## 2.1.1 검색
엔진은 스코프 버블의 구조와 상대적 위치를 통해, 어디를 검색해야 확인자를 찾을 수 있는지를 알고 있다.

글로벌 변수는 자동적으로 웹 브라우저의 `window`처럼 글로벌 객체에 속한다. ( nodejs의 경우 `global` 객체)

## 2.2 렉시컬 속이기
렉시컬 속이기란, 렉서 단계에서 결정된 렉시컬 스코프에 수정을 가하는 것으로, 여러가지 방법있지만 성능저하의 문제로 사용하지 않는 편이 좋다

- new Function 생성자에서 코드문자열을 파라미터로 넘기는 경우 <br>
  ```
  new Function('var a = 2');
  ```

- eval()

- setTimeout, setInterval에 코드문자열을 파라미터로 넘기는 경우
  ```
  setTimeout('var a = 2', 1000);
  ```

- with (곧 없어질 예정)<br>
  with문은 일반적으로 하나의 객체의 여러속성을 참조할 때, 객체 참조를 매번하지 않기위해 사용하는 문법이다.
  ``` js
  //example
  var obj = {
    a: 1,
    b: 2,
    c: 3,
  };
  with (obj) {
    a = 3;
    b = 4;
    c = 5;
  }
  ```

  하지만 `non-strict mode`에서 with문은 참조하는 객체가 가지고 있지않은 프로퍼티를 참조하게 될 떼, 엔진은 LHS검색을 실행하기 때문에, 글로벌 변수에 참조하려했던 변수(프로퍼티)를 생성하게 된다는 문제점이 있다. (렉시컬 속이기가 생기는 이유)

## 2.2.3 성능
자바스크립트 엔진은 컴파일레이션 단계에서 상당수의 최적화 작업을 진행하는데, 이 최적화의 일부분이 하는 핵심 작업은 렉싱된 코드를 분석하여, 모든 변수와 함수 선언문이 어디에 있는지 파악하고 실행 과정에서 확인자 검색을 더 빠르게 하는 것이다. 하지만 위의 나열된 with, eval 함수를 사용하게 되면, 엔진은 미리 확인해둔 확인자의 위치가 틀릴 수도 있다고 가정해야 하기 때문에, 기존에 최적화되어 있는것의 의미가 사라져 버린다.